<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Event Digital Map (Multi-Floor)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Neutral Gray & Vibrant Blue -->
    <!-- Application Structure Plan: The SPA is enhanced to support multiple floors. A floor switcher UI is added, allowing users to toggle between different 2D floor plans. The core data structure is updated to include a 'floor' property for each booth. JavaScript logic now filters and renders booths based on the currently selected floor. This maintains the intuitive map-centric design while handling vertical space. -->
    <!-- Visualization & Content Choices: 1. Floor Switcher (HTML Buttons): Goal=Organize. Provides clear navigation between floors. Interaction=Click to change floor view. Justification=Standard and universally understood UI pattern for multi-level maps. 2. Updated Floor Plan (Filtered Grid): Goal=Organize. Displays only the relevant booths for the active floor. Interaction=Click on booth. Justification=Prevents information overload and keeps the map clean and relevant to the user's context. 3. GPS Navigation: Remains the same, but is now context-aware of the selected floor. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Kanit', sans-serif;
        }
        .booth {
            transition: all 0.2s ease-in-out;
        }
        .booth:hover {
            transform: scale(1.05);
            z-index: 10;
            background-color: #93c5fd; /* blue-300 */
        }
        #user-location-dot {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #3b82f6;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 0 10px #3b82f6;
            transform: translate(-50%, -50%);
            display: none;
            animation: pulse 2s infinite;
            z-index: 20;
            transition: left 0.5s linear, top 0.5s linear;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(59, 130, 246, 0); }
            100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        }
        .floor-btn.active {
            background-color: #1d4ed8;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto p-4 max-w-4xl">
        <header class="text-center my-6">
            <h1 class="text-4xl font-bold text-gray-800">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏¥‡∏à‡∏¥‡∏ó‡∏±‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô Event</h1>
            <p class="text-lg text-gray-600 mt-2">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏•‡πá‡∏≠‡∏Ñ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á</p>
        </header>

        <!-- Floor Switcher -->
        <div id="floor-switcher" class="flex justify-center items-center space-x-2 mb-4 bg-white p-2 rounded-lg shadow-md">
            <button class="floor-btn flex-1 py-2 px-4 rounded-md font-semibold transition-colors active" data-floor="1">‡∏ä‡∏±‡πâ‡∏ô 1</button>
            <button class="floor-btn flex-1 py-2 px-4 rounded-md font-semibold transition-colors bg-gray-200 text-gray-700" data-floor="2">‡∏ä‡∏±‡πâ‡∏ô 2</button>
        </div>

        <div id="map-container" class="relative bg-white p-4 rounded-lg shadow-lg">
            <div id="map-grid" class="grid gap-2" style="grid-template-columns: repeat(6, 1fr); grid-template-rows: repeat(4, 1fr);">
                <!-- Booths generated here -->
            </div>
            <canvas id="nav-canvas" class="absolute top-0 left-0 w-full h-full pointer-events-none z-10"></canvas>
            <div id="user-location-dot"></div>
        </div>
        <p id="nav-disclaimer" class="text-center text-sm text-gray-500 mt-2 hidden">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏: ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô‡∏à‡∏£‡∏¥‡∏á</p>
    </div>

    <div id="shop-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] overflow-y-auto">
            <div class="p-6">
                <div class="flex justify-between items-start">
                    <h2 id="modal-shop-name" class="text-3xl font-bold text-gray-800"></h2>
                    <button onclick="hideModal()" class="text-gray-500 hover:text-gray-800 text-3xl">&times;</button>
                </div>
                <p id="modal-shop-description" class="text-gray-600 mt-2 mb-4"></p>
                <div class="aspect-w-16 aspect-h-9 mb-4">
                     <iframe id="modal-video" class="w-full h-full rounded" src="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                </div>
                <div class="flex flex-col sm:flex-row gap-4">
                    <a id="modal-gmap-link" href="#" target="_blank" class="flex-1 text-center bg-blue-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                        üìç ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÑ‡∏õ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤‡∏à‡∏£‡∏¥‡∏á
                    </a>
                    <button id="modal-navigate-button" class="flex-1 text-center bg-green-600 text-white font-semibold py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">
                        üß≠ ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡πÉ‡∏ô‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>
        </div>
    </div>

<script>
// --- CONFIGURATION: Map Calibration (IMPORTANT!) ---
const mapCalibration = {
    topLeft:     { lat: 13.73782, lon: 100.56053 }, 
    bottomRight: { lat: 13.73768, lon: 100.56067 } 
};

// --- CONFIGURATION: Shop Data with Floor Property ---
const shopData = [
    // Floor 1
    { id: 'A1', name: '‡∏£‡πâ‡∏≤‡∏ô‡∏Å‡∏≤‡πÅ‡∏ü‡∏´‡∏≠‡∏°‡∏Å‡∏£‡∏∏‡πà‡∏ô', col: 1, row: 1, floor: 1, description: '‡∏Å‡∏≤‡πÅ‡∏ü‡∏™‡∏î‡πÉ‡∏´‡∏°‡πà‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏•‡πá‡∏î‡∏≠‡∏≤‡∏£‡∏≤‡∏ö‡∏¥‡∏Å‡πâ‡∏≤‡πÅ‡∏ó‡πâ 100%', videoUrl: 'https://www.youtube.com/embed/jfKfPfyJRdk', googleMapsUrl: 'https://maps.app.goo.gl/u5n9gZ1YqL8Xz7hR8' },
    { id: 'A2', name: '‡πÄ‡∏ö‡πÄ‡∏Å‡∏≠‡∏£‡∏µ‡πà‡πÇ‡∏Æ‡∏°‡πÄ‡∏°‡∏î', col: 2, row: 1, floor: 1, description: '‡∏Ç‡∏ô‡∏°‡∏õ‡∏±‡∏á‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡πâ‡∏Å‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô', videoUrl: 'https://www.youtube.com/embed/gWrf4a-d_xE', googleMapsUrl: 'https://maps.app.goo.gl/u5n9gZ1YqL8Xz7hR8' },
    { id: 'B1', name: '‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏õ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏≥‡∏°‡∏∑‡∏≠', col: 1, row: 2, floor: 1, description: '‡∏™‡∏£‡πâ‡∏≠‡∏¢‡∏Ñ‡∏≠‡πÅ‡∏•‡∏∞‡∏ï‡πà‡∏≤‡∏á‡∏´‡∏π‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÄ‡∏Å‡πã ‡πÑ‡∏°‡πà‡∏ã‡πâ‡∏≥‡πÉ‡∏Ñ‡∏£', videoUrl: 'https://www.youtube.com/embed/jfKfPfyJRdk', googleMapsUrl: 'https://maps.app.goo.gl/u5n9gZ1YqL8Xz7hR8' },
    { id: 'B3', name: '‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤/‡∏≠‡∏≠‡∏Å', col: 1, row: 4, floor: 1, description: '‡∏õ‡∏£‡∏∞‡∏ï‡∏π‡∏ó‡∏≤‡∏á‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏≠‡∏á‡∏á‡∏≤‡∏ô', type: 'utility' },
    { id: 'C3', name: '‡πÄ‡∏ß‡∏ó‡∏µ‡∏Å‡∏•‡∏≤‡∏á', col: 3, row: 4, floor: 1, colSpan: 2, description: '‡πÄ‡∏ß‡∏ó‡∏µ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á', type: 'utility' },
    { id: 'S1', name: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô', col: 6, row: 1, floor: 1, description: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ‡∏ä‡∏±‡πâ‡∏ô 2', type: 'utility' },
    { id: 'E1', name: '‡∏•‡∏¥‡∏ü‡∏ï‡πå', col: 6, row: 4, floor: 1, description: '‡∏•‡∏¥‡∏ü‡∏ï‡πå', type: 'utility' },

    // Floor 2
    { id: 'D1', name: '‡∏£‡πâ‡∏≤‡∏ô‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠', col: 1, row: 1, floor: 2, description: '‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢‡πÅ‡∏ô‡∏ß ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏©', videoUrl: 'https://www.youtube.com/embed/jfKfPfyJRdk', googleMapsUrl: 'https://maps.app.goo.gl/u5n9gZ1YqL8Xz7hR8' },
    { id: 'D2', name: '‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÑ‡∏≠‡∏ó‡∏µ', col: 2, row: 1, floor: 2, description: 'Gadget ‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠', videoUrl: 'https://www.youtube.com/embed/gWrf4a-d_xE', googleMapsUrl: 'https://maps.app.goo.gl/u5n9gZ1YqL8Xz7hR8' },
    { id: 'D3', name: '‡πÄ‡∏™‡∏∑‡πâ‡∏≠‡∏ú‡πâ‡∏≤‡∏Å‡∏µ‡∏¨‡∏≤', col: 3, row: 1, floor: 2, description: '‡∏ä‡∏∏‡∏î‡∏≠‡∏≠‡∏Å‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏≠‡∏∏‡∏õ‡∏Å‡∏£‡∏ì‡πå‡∏Å‡∏µ‡∏¨‡∏≤', videoUrl: 'https://www.youtube.com/embed/jfKfPfyJRdk', googleMapsUrl: 'https://maps.app.goo.gl/u5n9gZ1YqL8Xz7hR8' },
    { id: 'S2', name: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô', col: 6, row: 1, floor: 2, description: '‡∏ö‡∏±‡∏ô‡πÑ‡∏î‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏•‡∏á‡πÑ‡∏õ‡∏ä‡∏±‡πâ‡∏ô 1', type: 'utility' },
    { id: 'E2', name: '‡∏•‡∏¥‡∏ü‡∏ï‡πå', col: 6, row: 4, floor: 2, description: '‡∏•‡∏¥‡∏ü‡∏ï‡πå', type: 'utility' },
    { id: 'F1', name: '‡∏à‡∏∏‡∏î‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô', col: 1, row: 4, floor: 2, description: '‡πÇ‡∏ã‡∏ô‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÅ‡∏•‡∏∞‡∏à‡∏∏‡∏î‡∏ä‡∏≤‡∏£‡πå‡∏à‡πÅ‡∏ö‡∏ï', type: 'utility' }
];

const mapGrid = document.getElementById('map-grid');
const modal = document.getElementById('shop-modal');
const userLocationDot = document.getElementById('user-location-dot');
const navCanvas = document.getElementById('nav-canvas');
const navDisclaimer = document.getElementById('nav-disclaimer');
const floorSwitcher = document.getElementById('floor-switcher');
const ctx = navCanvas.getContext('2d');

let currentUserPosition = null;
let currentNavTarget = null;
let watchId = null;
let currentFloor = 1;

function renderMap(floor) {
    mapGrid.innerHTML = '';
    const boothsForFloor = shopData.filter(shop => shop.floor === floor);
    
    boothsForFloor.forEach(shop => {
        const booth = document.createElement('div');
        booth.id = `booth-${shop.id}`;
        booth.className = 'booth aspect-square flex items-center justify-center p-2 border-2 rounded-md cursor-pointer';
        booth.style.gridColumnStart = shop.col;
        booth.style.gridRowStart = shop.row;
        if (shop.colSpan) booth.style.gridColumnEnd = `span ${shop.colSpan}`;
        if (shop.rowSpan) booth.style.gridRowEnd = `span ${shop.rowSpan}`;
        
        if (shop.type === 'utility') {
            booth.classList.add('bg-yellow-200', 'border-yellow-400');
        } else {
            booth.classList.add('bg-gray-200', 'border-gray-400');
        }

        booth.innerHTML = `<span class="font-semibold text-gray-700 text-center text-sm md:text-base">${shop.id}<br>${shop.name.split(' ')[0]}</span>`;
        if (shop.type !== 'utility') {
            booth.addEventListener('click', () => showModal(shop));
        }
        mapGrid.appendChild(booth);
    });
}

function showModal(shop) {
    document.getElementById('modal-shop-name').textContent = shop.name;
    document.getElementById('modal-shop-description').textContent = shop.description;
    document.getElementById('modal-video').src = shop.videoUrl || '';
    document.getElementById('modal-gmap-link').href = shop.googleMapsUrl || '#';
    const navigateButton = document.getElementById('modal-navigate-button');
    navigateButton.onclick = () => navigateToBooth(shop.id);
    modal.classList.remove('hidden');
}

function hideModal() {
    document.getElementById('modal-video').src = '';
    modal.classList.add('hidden');
}

function stopNavigation() {
    if (watchId) navigator.geolocation.clearWatch(watchId);
    watchId = null;
    currentNavTarget = null;
    userLocationDot.style.display = 'none';
    clearNavigationLine();
}

function gpsToMapCoordinates(lat, lon) {
    const mapRect = mapGrid.getBoundingClientRect();
    if (!mapRect.width || !mapRect.height) return null;
    const totalLatDiff = mapCalibration.topLeft.lat - mapCalibration.bottomRight.lat;
    const totalLonDiff = mapCalibration.bottomRight.lon - mapCalibration.topLeft.lon;
    if (totalLatDiff <= 0 || totalLonDiff <= 0) return null;
    const userLatDiff = mapCalibration.topLeft.lat - lat;
    const userLonDiff = lon - mapCalibration.topLeft.lon;
    const yPercent = userLatDiff / totalLatDiff;
    const xPercent = userLonDiff / totalLonDiff;
    const x = mapRect.width * xPercent;
    const y = mapRect.height * yPercent;
    return { x, y };
}

function navigateToBooth(boothId) {
    hideModal();
    stopNavigation();
    currentNavTarget = boothId;
    
    if (navigator.geolocation) {
        watchId = navigator.geolocation.watchPosition(
            (position) => {
                const { latitude, longitude } = position.coords;
                currentUserPosition = gpsToMapCoordinates(latitude, longitude);
                if (currentUserPosition) {
                    userLocationDot.style.display = 'block';
                    userLocationDot.style.left = `${currentUserPosition.x}px`;
                    userLocationDot.style.top = `${currentUserPosition.y}px`;
                    drawNavigationLine(currentNavTarget);
                }
            }, 
            (error) => {
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡πÑ‡∏î‡πâ: ' + (error.message || '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î'));
                stopNavigation();
            },
            { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
        );
    } else {
        alert('‡πÄ‡∏ö‡∏£‡∏≤‡∏ß‡πå‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏°‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á');
    }
}

function drawNavigationLine(boothId) {
    if (!currentUserPosition || !boothId) return;
    const targetBooth = document.getElementById(`booth-${boothId}`);
    if (!targetBooth) return; // Target booth might be on another floor

    const targetX = targetBooth.offsetLeft + targetBooth.offsetWidth / 2;
    const targetY = targetBooth.offsetTop + targetBooth.offsetHeight / 2;

    navCanvas.width = mapGrid.offsetWidth;
    navCanvas.height = mapGrid.offsetHeight;
    ctx.clearRect(0, 0, navCanvas.width, navCanvas.height);
    
    ctx.beginPath();
    ctx.moveTo(currentUserPosition.x, currentUserPosition.y);
    ctx.lineTo(targetX, targetY);
    ctx.strokeStyle = '#3b82f6';
    ctx.lineWidth = 4;
    ctx.setLineDash([5, 5]);
    ctx.stroke();

    ctx.fillStyle = '#16a34a';
    ctx.beginPath();
    ctx.arc(targetX, targetY, 10, 0, 2 * Math.PI);
    ctx.fill();

    navDisclaimer.classList.remove('hidden');
}

function clearNavigationLine() {
    ctx.clearRect(0, 0, navCanvas.width, navCanvas.height);
    navDisclaimer.classList.add('hidden');
}

floorSwitcher.addEventListener('click', (e) => {
    if (e.target.tagName === 'BUTTON') {
        const floor = parseInt(e.target.dataset.floor, 10);
        if (floor !== currentFloor) {
            currentFloor = floor;
            stopNavigation();
            renderMap(currentFloor);
            // Update button styles
            const currentActive = floorSwitcher.querySelector('.active');
            if(currentActive) {
                currentActive.classList.remove('active', 'bg-blue-600', 'text-white');
                currentActive.classList.add('bg-gray-200', 'text-gray-700');
            }
            e.target.classList.add('active', 'bg-blue-600', 'text-white');
            e.target.classList.remove('bg-gray-200', 'text-gray-700');
        }
    }
});

window.onload = () => renderMap(currentFloor);
window.onresize = () => {
    if (currentNavTarget) {
        drawNavigationLine(currentNavTarget);
    }
};

</script>

</body>
</html>

